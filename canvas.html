<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="user-scalable=0">
		<title>Canvas3D</title>
		<style>
			html,body{
				height:100%;
				width:100%;
			}
			body{
				padding:0;
				margin:0;
				border:0;
			}
		</style>
	</head>

	<body>
		<canvas id="canvas"></canvas>
		<script>

			/*
			** Structs
			*/
			function Camera(positionX,positionY,positionZ,angleX,angleY,angleZ){
				this.px = positionX;
				this.py = positionY;
				this.pz = positionZ;
				this.ax = angleX;
				this.ay = angleY;
				this.az = angleZ;
				return this;
			}

			function Vector(x,y,z){
				this.x = x;
				this.y = y;
				this.z = z;
				this.x2d = null;
				this.y2d = null;
				return this;
			}

			/*
			** Canvas Functions
			*/

			function CanvasInitialize(canvasID){
				var canvas = document.getElementById(canvasID);
				canvas.width = document.body.clientWidth;
				canvas.height = document.body.clientHeight;
				var ctx = canvas.getContext("2d");
				ctx.fillStyle = "#000000";
				return ctx;
			}

			/*
			** Drawing Functions
			*/

			function drawMark(ctx,x,y){
				ctx.fillRect(x-3,y-3,6,6);
			}

			function drawLine(ctx,x1,y1,x2,y2){
				ctx.beginPath();
				ctx.moveTo(x1,y1);
				ctx.lineTo(x2,y2);
				ctx.stroke();
				ctx.closePath();
			}

			/*
			** Variables
			*/

			var cam1 = Camera(-0.2,3,0.5,0,0,0);

			var vecList = [new Vector(0 ,0 ,0 ),
						   new Vector(0 ,50,0 ),
						   new Vector(50,0 ,0 ),
						   new Vector(50,50,0 ),
						   new Vector(0 ,0 ,50),
						   new Vector(0 ,50,50),
						   new Vector(50,0 ,50),
						   new Vector(50,50,50)];

			//定义线的顶点连接
			var lineArr=new Array(0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7);

			//绘制主程序
			function maindraw()
			{
				//清屏
				ctx.clearRect(0,0,canvas.width,canvas.height);
				//转换顶点X坐标
				for(tmp=0;tmp<8;tmp++)
				{
					xDispArr[tmp] = (xArr[tmp] - cameraX) / (zArr[tmp] + cameraZ);
				}
				//转换顶点Y坐标
				for(tmp=0;tmp<8;tmp++)
				{
					yDispArr[tmp] = (yArr[tmp]-cameraY) / (zArr[tmp]+cameraZ);
				}
				//逐个绘制顶点
				for(tmp=0;tmp<8;tmp++)
				{
					drawXyPt(xDispArr[tmp],yDispArr[tmp]);
				}
				//连线
				for(tmp=0;tmp<lineArr.length;tmp+=2)
				{
					tmpx1=xDispArr[lineArr[tmp]]*(bodyWidth/20);
					tmpy1=yDispArr[lineArr[tmp]]*(bodyWidth/20);
					tmpx1+=(bodyWidth/2);
					tmpy1=(bodyHeight/2)-tmpy1;
					tmpx2=xDispArr[lineArr[tmp+1]]*bodyWidth/20;
					tmpy2=yDispArr[lineArr[tmp+1]]*bodyWidth/20;
					tmpx2+=bodyWidth/2;
					tmpy2=bodyHeight/2-tmpy2;
					lineConnect(tmpx1,tmpy1,tmpx2,tmpy2);
				}
				requestAnimationFrame(maindraw);
			}

			requestAnimationFrame(maindraw);

		</script>

		<script>
			//检测按键按下
			window.onkeydown=function(){
				if(event.keyCode == 74){
					//alert('j');
					cameraY = cameraY - 0.1;
				}
				else if(event.keyCode == 65){
					//alert('a');
					cameraX = cameraX - 0.3;
				}
				else if(event.keyCode == 75){
					//alert('k');
					cameraY = cameraY + 0.1;
				}
				else if(event.keyCode == 68){
					//alert('d');
					cameraX = cameraX + 0.3;
				}
				else if(event.keyCode == 87){
					//alert('w');
					cameraZ = cameraZ - 0.04;
				}
				else if(event.keyCode == 83){
					//alert('s');
					cameraZ = cameraZ + 0.04;
				}
			}
		</script>
	</body>
</html>