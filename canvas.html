<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="user-scalable=0">
		<title>Canvas3D</title>
		<style>
			html,body{
				height:100%;
				width:100%;
			}
			body{
				padding:0;
				margin:0;
				border:0;
			}
		</style>
	</head>

	<body>
		<canvas id="canvas1"></canvas>
		<script>

			/*
			** Structs
			*/
			function Camera(positionX, positionY, positionZ, angleX, angleY, angleZ, screenWidth, screenHeight){
				this.x            = positionX;
				this.y            = positionY;
				this.z            = positionZ;
				this.anglex       = angleX;
				this.angley       = angleY;
				this.anglez       = angleZ;
				this.screenWidth  = screenWidth;
				this.screenHeight = screenHeight;
			}

			function Vector2D(x,y){
				this.x = x;
				this.y = y;
			}

			function Mesh2D(vec1,vec2,vec3){
				this.vec1 = vec1;
				this.vec2 = vec2;
				this.vec3 = vec3;
			}

			function World2D(){
				this.meshlist = [];
			}

			function Vector4D(x,y,z){
				this.x = x;
				this.y = y;
				this.z = z;
				this.w = 1;
			}

			function Mesh4D(vec1,vec2,vec3){
				this.vec1 = vec1;
				this.vec2 = vec2;
				this.vec3 = vec3;
			}

			function Object4D(meshlist){
				this.meshlist = meshlist;
			}

			function World4D(){
				this.meshlist = [];
				this.PlaceObject4D = function(newObject,x,y,z){
					for(var i = 0; i < newObject.meshlist.length; i++){
						this.meshlist.push(new Mesh4D(new Vector4D(newObject.meshlist[i].vec1.x + x,
																   newObject.meshlist[i].vec1.y + y,
																   newObject.meshlist[i].vec1.z + z,),
													  new Vector4D(newObject.meshlist[i].vec2.x + x,
																   newObject.meshlist[i].vec2.y + y,
																   newObject.meshlist[i].vec2.z + z,),
													  new Vector4D(newObject.meshlist[i].vec3.x + x,
																   newObject.meshlist[i].vec3.y + y,
																   newObject.meshlist[i].vec3.z + z,)));
					}
					this.meshlist.push();
				}
			}

			/*
			** Canvas Functions
			*/

			function CanvasInit(canvasID, width, height){
				var canvas    = document.getElementById(canvasID);
				var ctx       = canvas.getContext("2d");
				canvas.width  = width;
				canvas.height = height;
				return ctx;
			}

			function CanvasDrawVector2D(ctx, vector){
				ctx.fillStyle   = "#000000";
				ctx.fillRect(vector.x-3, //Start X Position
							 vector.y-3, //Start Y Position
							 6,          //Width
							 6);         //Height
			}

			function CanvasDrawMesh2D(ctx, mesh, color){
				CanvasDrawVector2D(ctx, mesh.vec1);
				CanvasDrawVector2D(ctx, mesh.vec2);
				CanvasDrawVector2D(ctx, mesh.vec3);

				ctx.fillStyle   = "rgba(0,144,255,0.5)";
				ctx.strokeStyle = "#000000";
				ctx.beginPath();
				ctx.moveTo(mesh.vec1.x, mesh.vec1.y);
				ctx.lineTo(mesh.vec2.x, mesh.vec2.y);
				ctx.lineTo(mesh.vec3.x, mesh.vec3.y);
				ctx.lineTo(mesh.vec1.x, mesh.vec1.y);
				ctx.fill();
				ctx.stroke();
				ctx.closePath();
			}

			function CanvasDrawWorld2D(ctx, world, color){
				for(var i = 0; i < world.meshlist.length; i++){
					CanvasDrawMesh2D(ctx, world.meshlist[i], color);
				}
			}

			/*
			** Projection Functions
			*/

			function Vector4D2Vector2D(camera,vector){
				var zoom    = 200;
				var x2d     = (vector.x - camera.x) / (vector.z + camera.z);
				var y2d     = (vector.y - camera.y) / (vector.z + camera.z);
				var xScreen = (camera.screenWidth  / 2) + (x2d * zoom);
				var yScreen = (camera.screenHeight / 2) + (y2d * zoom);
				return new Vector2D(xScreen, yScreen);
			}

			function Mesh4D2Mesh2D(camera,mesh4d){
				return new Mesh2D(Vector4D2Vector2D(camera, mesh4d.vec1),
								  Vector4D2Vector2D(camera, mesh4d.vec2),
								  Vector4D2Vector2D(camera, mesh4d.vec3));
			}

			function World4D2World2D(camera,world4d){
				var world2d = new World2D();
				for(var i = 0; i < world4d.meshlist.length; i++){
					world2d.meshlist.push(Mesh4D2Mesh2D(camera, world4d.meshlist[i]));
				}
				//console.log(camera.x);
				return world2d;
			}
			
			window.onload = function(){
				cam1 = new Camera(5, 5, 0, 0, 0, 0, document.body.clientWidth, document.body.clientHeight);//global variable,with no "var"
				var ctx  = CanvasInit("canvas1", cam1.screenWidth, cam1.screenHeight);
				var obj1 = new Object4D([new Mesh4D(new Vector4D(1,1,1), new Vector4D(4,1,1), new Vector4D(1,4,1)), //front
										 new Mesh4D(new Vector4D(1,4,1), new Vector4D(4,4,1), new Vector4D(4,1,1)), //front
										 new Mesh4D(new Vector4D(1,4,4), new Vector4D(1,1,4), new Vector4D(1,1,1)), //left
										 new Mesh4D(new Vector4D(1,4,4), new Vector4D(1,4,1), new Vector4D(1,1,1)), //left
										 new Mesh4D(new Vector4D(4,4,4), new Vector4D(4,1,4), new Vector4D(4,1,1)), //right
										 new Mesh4D(new Vector4D(4,4,4), new Vector4D(4,4,1), new Vector4D(4,1,1)), //right
										 new Mesh4D(new Vector4D(1,1,4), new Vector4D(4,1,4), new Vector4D(1,4,4)), //back
										 new Mesh4D(new Vector4D(1,4,4), new Vector4D(4,4,4), new Vector4D(4,1,4)), //back
										 new Mesh4D(new Vector4D(1,4,1), new Vector4D(1,4,4), new Vector4D(4,4,4)), //up
										 new Mesh4D(new Vector4D(1,4,1), new Vector4D(4,4,1), new Vector4D(4,4,4)), //up
										 new Mesh4D(new Vector4D(1,1,1), new Vector4D(1,1,4), new Vector4D(4,1,4)), //down
										 new Mesh4D(new Vector4D(1,1,1), new Vector4D(4,1,1), new Vector4D(4,1,4)), //down
										 ]);
				requestAnimationFrame(function main(){
					ctx.clearRect(0,0,cam1.screenWidth,cam1.screenHeight);
					var world4d1 = new World4D();
					world4d1.PlaceObject4D(obj1,2.5,2.5,2.5);
					var world2d1 = World4D2World2D(cam1,world4d1);
					CanvasDrawWorld2D(ctx,world2d1,"rgba(0,144,255,0.5)");
					console.log(cam1.x);
					requestAnimationFrame(main);
				});
			}

			window.onkeydown=function(){
				if(event.keyCode == 65){
					//alert('a');
					cam1.x -= 0.3;
				}
				else if(event.keyCode == 68){
					//alert('d');
					cam1.x += 0.3;
				}
				else if(event.keyCode == 74){
					//alert('j');
					cam1.y -= 0.3;
				}
				else if(event.keyCode == 75){
					//alert('k');
					cam1.y += 0.3;
				}
				else if(event.keyCode == 87){
					//alert('w');
					cam1.z -= 0.1;
				}
				else if(event.keyCode == 83){
					//alert('s');
					cam1.z += 0.1;
				}
			}
		</script>
	</body>
</html>