<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="user-scalable=0">
		<title>Canvas3D</title>
		<style>
			html,body{
				height:100%;
				width:100%;
			}
			body{
				padding:0;
				margin:0;
				border:0;
			}
		</style>
	</head>

	<body>
		<canvas id="canvas"></canvas>
		<script>

			/*
			** Structs
			*/
			function Camera(positionX,positionY,positionZ,angleX,angleY,angleZ){
				this.px = positionX;
				this.py = positionY;
				this.pz = positionZ;
				this.ax = angleX;
				this.ay = angleY;
				this.az = angleZ;
				return this;
			}

			function Vector(x,y,z){
				this.xo = x;
				this.yo = y;
				this.zo = z;
				this.x = null;
				this.y = null;
				this.z = null;
				this.x2d = null;
				this.y2d = null;
				return this;
			}

			/*
			** Canvas Functions
			*/

			function CanvasInitialize(canvasID){
				var canvas = document.getElementById(canvasID);
				canvas.width = document.body.clientWidth;
				canvas.height = document.body.clientHeight;
				var ctx = canvas.getContext("2d");
				ctx.fillStyle = "#000000";
				return ctx;
			}

			/*
			** Drawing Functions
			*/

			function drawMark(ctx,x,y){
				ctx.fillRect(x-3,y-3,6,6);
			}

			function drawLine(ctx,x1,y1,x2,y2){
				ctx.beginPath();
				ctx.moveTo(x1,y1);
				ctx.lineTo(x2,y2);
				ctx.stroke();
				ctx.closePath();
			}

			function angleProcess(camera,vector){
				vector.x = vector.xo;
				vector.y = vector.yo;
				vector.z = vector.zo;
				if(camera.ax != 0){
					vector.y = (vector.y * Math.cos(camera.ax)) + (vector.z * Math.sin(camera.ax));
					vector.z = (vector.z * Math.cos(camera.ax)) - (vector.y * Math.sin(camera.ax));
				}
				if(camera.ay != 0){
					vector.x = (vector.x * Math.cos(camera.ay)) - (vector.z * Math.sin(camera.ay));
					vector.z = (vector.x * Math.sin(camera.ay)) + (vector.z * Math.sin(camera.ay));
				}
				if(camera.ax != 0){
					vector.x = (vector.x * Math.cos(camera.az)) - (vector.y * Math.sin(camera.az));
					vector.y = (vector.x * Math.sin(camera.az)) + (vector.y * Math.cos(camera.az));
				}
				
			}
			function prespectiveProjection(camera,vector){
				vector.x2d = (document.body.clientWidth/2) +(vector.x - camera.px) / (vector.z + camera.pz);
				vector.y2d = (document.body.clientHeight/2) - ((vector.y - camera.py) / (vector.z + camera.pz));
			}

			/*
			** Variables
			*/

			var cam1 = Camera(-0.2,3,0.5,0,0,0);

			var vecList = [new Vector(0,0,0),
						   new Vector(200,0,0),
						   new Vector(200,200,0),
						   new Vector(0,200,0),
						   new Vector(0,0,1),
						   new Vector(200,0,1),
						   new Vector(200,200,1),
						   new Vector(0,200,1)];

			var lineStart = [0,1,2,3,   4,5,6,7,   0,1,2,3];
			var lineEnd   = [1,2,3,0,   5,6,7,4,   4,5,6,7];

			var ctx = CanvasInitialize("canvas");

			function main()
			{
				ctx.clearRect(0,0,canvas.width,canvas.height);

				//Process Vectors
				for(var i = 0;i<vecList.length;i++){
					angleProcess(cam1,vecList[i]);
					prespectiveProjection(cam1,vecList[i]);
					drawMark(ctx,vecList[i].x2d,vecList[i].y2d);
				}

				//Process Lines
				for(var i = 0;i<lineStart.length;i++){
					drawLine(ctx,
					         vecList[lineStart[i]].x2d,
							 vecList[lineStart[i]].y2d,
							 vecList[lineEnd  [i]].x2d,
							 vecList[lineEnd  [i]].y2d);
				}

				requestAnimationFrame(main);
			}

			requestAnimationFrame(main);

			window.onkeydown=function(){
				if(event.keyCode == 65){
					//alert('a');
					cam1.px += 3;
				}
				else if(event.keyCode == 68){
					//alert('d');
					cam1.px -= 3;
				}
				else if(event.keyCode == 74){
					//alert('j');
					cam1.py -= 3;
				}
				else if(event.keyCode == 75){
					//alert('k');
					cam1.py += 3;
				}
				else if(event.keyCode == 87){
					//alert('w');
					cam1.pz -= 0.01;
				}
				else if(event.keyCode == 83){
					//alert('s');
					cam1.pz += 0.01;
				}
				else if(event.keyCode == 90){
					//z
					cam1.ax += 0.00001;
				}
				else if(event.keyCode == 88){
					//x
					cam1.ax -= 0.00001;
				}
				else if(event.keyCode == 67){
					//z
					cam1.ay += 0.00001;
				}
				else if(event.keyCode == 86){
					//x
					cam1.ay -= 0.00001;
				}
				else if(event.keyCode == 66){
					//z
					cam1.az += 0.00001;
				}
				else if(event.keyCode == 78){
					//x
					cam1.az -= 0.00001;
				}

				else{
					alert(event.keyCode);
				}
				
			}
		</script>
	</body>
</html>