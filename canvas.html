<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="user-scalable=0">
		<script src="canvas.js"></script>
		<title>Canvas3D</title>
		<style>
			html,body{
				height:100%;
				width:100%;
			}
			body{
				padding:0;
				margin:0;
				border:0;
			}
		</style>
	</head>

	<body>
		<canvas id="canvas"></canvas>
		<script>
			/*
			** Variables
			*/

			var cam1 = Camera(-0.2,3,0.5,0,0,0);

			var vecList = [new Vertex(1,1,1),
						   new Vertex(200,1,1),
						   new Vertex(200,200,1),
						   new Vertex(1,200,1),
						   new Vertex(1,1,2),
						   new Vertex(200,1,2),
						   new Vertex(200,200,2),
						   new Vertex(1,200,2)];

			var lineStart = [0,1,2,3,   4,5,6,7,   0,1,2,3];
			var lineEnd   = [1,2,3,0,   5,6,7,4,   4,5,6,7];

			var ctx = CanvasInitialize("canvas");

			function main()
			{
				ctx.clearRect(0,0,canvas.width,canvas.height);

				//Process Vertexs
				for(var i = 0;i<vecList.length;i++){
					vecList[i] = rotation(cam1,vecList[i]);
					vecList[i] = prespectiveProjection(cam1,vecList[i]);
					drawMark(ctx,vecList[i].x2d,vecList[i].y2d);
				}

				//Process Lines
				for(var i = 0;i<lineStart.length;i++){
					drawLine(ctx,
					         vecList[lineStart[i]].x2d,
							 vecList[lineStart[i]].y2d,
							 vecList[lineEnd  [i]].x2d,
							 vecList[lineEnd  [i]].y2d);
				}

				requestAnimationFrame(main);
			}

			function rotation(camera,vertex){
				// console.log("1:");
				// console.log(vertex);
				// console.log("\n\n\n\n\n");

				var stmp = cver2sver(vertex);
				// console.log(stmp);
				// console.log("before:" + stmp.phi);
				stmp.phi += 0.0002;
				// console.log("after:" + stmp.phi);
				vertex = sver2cver(stmp);
				return vertex;
			}
			requestAnimationFrame(main);

			/*
			** Keyboard control
			*/
			window.onkeydown=function(){
				if(event.keyCode == 65){
					//alert('a');
					cam1.x -= 3;
				}
				else if(event.keyCode == 68){
					//alert('d');
					cam1.x += 3;
				}
				else if(event.keyCode == 74){
					//alert('j');
					cam1.y -= 3;
				}
				else if(event.keyCode == 75){
					//alert('k');
					cam1.y += 3;
				}
				else if(event.keyCode == 87){
					//alert('w');
					cam1.z -= 0.01;
				}
				else if(event.keyCode == 83){
					//alert('s');
					cam1.z += 0.01;
				}

				else{
					alert(event.keyCode);
				}
				
			}
		</script>
	</body>
</html>